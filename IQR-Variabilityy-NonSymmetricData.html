<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>IQR, Histogram, and Spread Relationship</title>
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f7f7f7;
    }
    h1 {
      margin-bottom: 4px;
    }
    .top-layout {
      display: flex;
      gap: 16px;
      align-items: flex-start;
      margin-bottom: 10px;
    }
    #chart {
      flex: 2 1 0;
      height: 500px;
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    #stats-box {
      flex: 1 1 260px;
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 13px;
      line-height: 1.4;
    }
    #stats-box h2 {
      margin-top: 0;
      font-size: 16px;
      margin-bottom: 6px;
    }
    #stats-box h3 {
      margin: 8px 0 2px;
      font-size: 14px;
    }
    #stats-box p {
      margin: 2px 0;
    }
    .explain-box {
      margin-top: 8px;
      padding: 12px;
      background: #eef4ff;
      border: 1px solid #c6d8ff;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.45;
    }
    .explain-box h2 {
      margin-top: 0;
      font-size: 17px;
      color: #1e3a8a;
    }
  </style>
</head>

<body>

  <h1>Relationship Between Histogram, IQR, and Spread</h1>
  <p>
    This visualization compares three datasets with different interquartile ranges (IQRs)
    to show how the spread of the data changes the shape of the histogram.
  </p>

  <div class="top-layout">
    <div id="chart"></div>
    <div id="stats-box">
      <h2>Summary Statistics</h2>
      <p>Loading...</p>
    </div>
  </div>

  <!-- DESCRIPTION BOX 1 -->
  <div class="explain-box">
    <h2>1. What the histogram shows</h2>
    A histogram shows how the data values are distributed.
    Each bar tells you how many data points fall in that interval.
    A narrow histogram means most values are close together.
    A wide histogram means the values are spread out across many intervals.
  </div>

  <!-- DESCRIPTION BOX 2 -->
  <div class="explain-box">
    <h2>2. What the IQR means</h2>
    The IQR (interquartile range) measures the middle 50 percent of the data.
    It is the distance between the first quartile (Q1) and the third quartile (Q3).
    A small IQR means the middle part of the data is tightly packed.
    A large IQR means the middle part of the data is more spread out.
  </div>

  <!-- DESCRIPTION BOX 3 -->
  <div class="explain-box">
    <h2>3. What spread or variability means</h2>
    Spread tells us how different the data values are from one another.
    Low variability means the values are very similar.
    High variability means the values are more different.
    In this chart, a larger IQR creates a wider histogram, which means higher variability.
  </div>

  <script>
    // -------- Helper functions --------
    function quantile(arr, q) {
      var sorted = arr.slice().sort(function(a, b) { return a - b; });
      var pos = (sorted.length - 1) * q;
      var base = Math.floor(pos);
      var rest = pos - base;
      return sorted[base + 1] !== undefined
        ? sorted[base] + rest * (sorted[base + 1] - sorted[base])
        : sorted[base];
    }

    function IQR(arr) {
      var q1 = quantile(arr, 0.25);
      var q3 = quantile(arr, 0.75);
      return { q1: q1, q3: q3, iqr: q3 - q1 };
    }

    function mean(arr) {
      var sum = 0;
      for (var i = 0; i < arr.length; i++) {
        sum += arr[i];
      }
      return sum / arr.length;
    }

    // Simple normal random (Box-Muller transform)
    function randn() {
      var u = 0, v = 0;
      while (u === 0) u = Math.random();
      while (v === 0) v = Math.random();
      return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
    }

    // -------- Three larger datasets with same center but different spreads --------
    function makeData(meanVal, std, n) {
      var arr = [];
      for (var i = 0; i < n; i++) {
        arr.push(meanVal + std * randn());
      }
      return arr;
    }

    var smallData  = makeData(50, 2, 300);   // small spread, small IQR
    var mediumData = makeData(50, 5, 300);   // medium spread, medium IQR
    var largeData  = makeData(50, 10, 300);  // large spread, large IQR

    var statsSmall  = IQR(smallData);
    var statsMedium = IQR(mediumData);
    var statsLarge  = IQR(largeData);

    statsSmall.mean  = mean(smallData);
    statsMedium.mean = mean(mediumData);
    statsLarge.mean  = mean(largeData);

    statsSmall.median  = quantile(smallData, 0.5);
    statsMedium.median = quantile(mediumData, 0.5);
    statsLarge.median  = quantile(largeData, 0.5);

    // -------- Histogram traces --------
    var traceSmall = {
      x: smallData,
      type: "histogram",
      opacity: 0.45,
      name: "Small IQR",
      marker: { color: "#1f77b4" },
      nbinsx: 20,
      visible: true
    };

    var traceMedium = {
      x: mediumData,
      type: "histogram",
      opacity: 0.45,
      name: "Medium IQR",
      marker: { color: "#ff7f0e" },
      nbinsx: 20,
      visible: true
    };

    var traceLarge = {
      x: largeData,
      type: "histogram",
      opacity: 0.45,
      name: "Large IQR",
      marker: { color: "#2ca02c" },
      nbinsx: 20,
      visible: true
    };

    // -------- Quartile lines --------
    function makeQuartileShapes(arr, stats, color) {
      return [
        {
          type: "line",
          x0: stats.q1, x1: stats.q1,
          y0: 0, y1: 1, yref: "paper",
          line: { color: color, width: 2, dash: "dot" }
        },
        {
          type: "line",
          x0: quantile(arr, 0.5), x1: quantile(arr, 0.5),
          y0: 0, y1: 1, yref: "paper",
          line: { color: "#2563eb", width: 2, dash: "dash" }
        },
        {
          type: "line",
          x0: stats.q3, x1: stats.q3,
          y0: 0, y1: 1, yref: "paper",
          line: { color: color, width: 2, dash: "dot" }
        }
      ];
    }

    var shapesSmall  = makeQuartileShapes(smallData,  statsSmall,  "#22c55e");
    var shapesMedium = makeQuartileShapes(mediumData, statsMedium, "#fbbf24");
    var shapesLarge  = makeQuartileShapes(largeData,  statsLarge,  "#f97316");
    var shapesAll    = [].concat(shapesSmall, shapesMedium, shapesLarge);

    // -------- Stats box HTML --------
    function formatStatsRow(label, stats) {
      return (
        "<h3>" + label + "</h3>" +
        "<p>Mean: "   + stats.mean.toFixed(2)   + "</p>" +
        "<p>Median: " + stats.median.toFixed(2) + "</p>" +
        "<p>Q1: "     + stats.q1.toFixed(2)     + "</p>" +
        "<p>Q3: "     + stats.q3.toFixed(2)     + "</p>" +
        "<p>IQR: "    + stats.iqr.toFixed(2)    + "</p>" +
        "<p style='margin-top:6px; font-weight:bold;'>Interpretation:</p>" +
        "<p style='margin-top:-6px;'>A larger IQR means the data is more spread out (higher variability). A smaller IQR means the data is more tightly grouped (lower variability).</p>"
      );
    }

    function updateStatsBox(mode) {
      var box = document.getElementById("stats-box");
      var html = "<h2>Summary Statistics</h2>";

      if (mode === "small") {
        html += formatStatsRow("Small IQR dataset", statsSmall);
      } else if (mode === "medium") {
        html += formatStatsRow("Medium IQR dataset", statsMedium);
      } else if (mode === "large") {
        html += formatStatsRow("Large IQR dataset", statsLarge);
      } else { // all
        html += formatStatsRow("Small IQR dataset", statsSmall);
        html += formatStatsRow("Medium IQR dataset", statsMedium);
        html += formatStatsRow("Large IQR dataset", statsLarge);
      }

      box.innerHTML = html;
    }

    // -------- Layout + Toggle Buttons --------
    var layout = {
      title: "Comparing Histogram Shape, IQR, and Variability (All Datasets)",
      xaxis: { title: "Value" },
      yaxis: { title: "Frequency" },
      barmode: "overlay",
      shapes: shapesAll,
      margin: { l: 60, r: 10, t: 60, b: 40 },
      legend: { orientation: "h", x: 0, y: 1.12 },
      updatemenus: [
        {
          type: "buttons",
          direction: "right",
          x: 0.0,
          y: 1.22,
          showactive: true,
          buttons: [
            {
              label: "Small IQR",
              method: "update",
              args: [
                { visible: [true, false, false] },
                {
                  title: "Small IQR (Low Variability)",
                  shapes: shapesSmall
                }
              ]
            },
            {
              label: "Medium IQR",
              method: "update",
              args: [
                { visible: [false, true, false] },
                {
                  title: "Medium IQR (Moderate Variability)",
                  shapes: shapesMedium
                }
              ]
            },
            {
              label: "Large IQR",
              method: "update",
              args: [
                { visible: [false, false, true] },
                {
                  title: "Large IQR (High Variability)",
                  shapes: shapesLarge
                }
              ]
            },
            {
              label: "Show All",
              method: "update",
              args: [
                { visible: [true, true, true] },
                {
                  title: "Comparing Histogram Shape, IQR, and Variability (All Datasets)",
                  shapes: shapesAll
                }
              ]
            }
          ]
        }
      ]
    };

    // -------- Render and hook up stats updates --------
    Plotly.newPlot("chart", [traceSmall, traceMedium, traceLarge], layout).then(function(gd) {
      // Default: show stats for all
      updateStatsBox("all");

      gd.on("plotly_buttonclicked", function(eventData) {
        var label = eventData.button.label;
        if (label === "Small IQR") {
          updateStatsBox("small");
        } else if (label === "Medium IQR") {
          updateStatsBox("medium");
        } else if (label === "Large IQR") {
          updateStatsBox("large");
        } else {
          updateStatsBox("all");
        }
      });
    });
  </script>

</body>
</html>
